package protocol;
import "Common.proto";
import "Card.proto";
import "PlayerBasic.proto";

message Chapter
{
	optional int32 chapter_id = 1;
	optional int32 total_star_num =2; //总星数
	repeated IntBoolPair limits = 4; //key:limitx val:是否领取 false:未领取 true已领取
}

message Instance
{
	optional int32 instance_id = 1;
	optional int32 star_num = 2; //最高星数
	optional int32 limit_num = 3; //-1无次数限制 x:还剩余x次
	optional int32 win_reward_status = 4; //领取状态 0不可领取 1可以领取 2已经领取 
}

message InstanceInfo 
{
	optional int32 normal_instance_progress = 1; //普通pve进度
	optional int32 elite_instance_progress = 2;	//精英pve进度
	optional int32 normal_chapter_progress = 3; //普通章节进度
	optional int32 elite_chapter_progress = 4;	//精英章节进度
	repeated Instance instances = 5; //pve副本记录
	repeated Chapter chapters = 6; //pve章节记录
	optional int32 last_instance_id = 7; //上一次参加的pve
	optional uint32 next_flush_times = 8;//下次刷新时间
}

message C2S_GetInstanceRequest
{
}

message S2C_GetInstanceResponse
{
	optional InstanceInfo instance_info = 1;
}

message S2C_UpdateInstanceInfo
{
	optional InstanceInfo instance_info = 1;
}

message C2S_EnterInstanceRequest
{
	required int32 instance_id = 1;
}

message S2C_EnterInstanceResponse
{
	required int32 res = 1; //0成功进入 x失败原因
}

message C2S_InstanceFinishRequest
{
	required int32 star_num = 1;
}

message S2C_InstanceFinishResponse
{
	required int32 res = 1; //0成功 x失败原因
	repeated IntPair reward_items = 2; //道具奖励
	optional int32 star_num = 3;
	repeated Card old_cards = 4;
	repeated Card new_cards = 5;
	optional BasicInfo old_basic_info = 6;
	optional BasicInfo new_basic_info = 7;
	repeated Resource old_resources = 8;
	repeated Resource new_resources = 9;
	optional bool is_win = 10;
}

message C2S_GetWinBoxRequest
{
	required int32 instance_id = 1;
}

message S2C_GetWinBoxResponse
{
	required int32 res = 1; //0成功 x失败原因
	repeated IntPair reward_items = 2; //道具奖励
}

message C2S_GetStarBoxRequest
{
	optional int32 chapter_id = 1;
	optional int32 limitx = 2;
}

message S2C_GetStarBoxResponse
{
	optional int32 res = 1; //0成功 x失败原因
	repeated IntPair reward_items = 2; //道具奖励
}

message C2S_SweepInstanceRequest
{
	optional int32 instance_id = 1;
	optional int32 sweep_num = 2;
}

message RewardByInstanceIndex
{
	optional int32 index = 1;
	optional int32 item_id = 2;
	optional int32 count = 3;
}

message S2C_SweepInstanceResponse
{
	required int32 res = 1; //0成功 x失败原因
	repeated RewardByInstanceIndex reward_items = 2; //道具奖励
}