package protocol;
import "Error.proto";
import "PlayerBasic.proto";
import "Item.proto";
import "Common.proto";

enum EGuildTitleType {
  GUILD_TITLE_INVALID = 0;
  GUILD_TITLE_CHAIRMAN = 1;
  GUILD_TITLE_VICE_CHAIRMAN = 2;
  GUILD_TITLE_ELITE_MEMBER = 3;
  GUILD_TITLE_MEMBER = 4;
}

message GuildMember {
  optional uint64 player_uid = 1;                   // player_uid
  optional BasicInfo basic_info = 2;                // 战队名、图标等信息
  optional EGuildTitleType title_type = 3;          // 职位
  optional uint32 contribution = 4;                 // 贡献活跃度
  optional bool online = 5;                         // 是否在线
  optional uint32 last_online_time = 6;             // 如果online=false，这个字段表示上次登录时间
  optional uint32 battle_force = 7;                 // 战斗力
  optional uint64 join_time = 8;                    // 加入时间
  optional uint32 best_team_dan = 9;                // 最强战队的段位
}

message GuildBasicInfo {
  optional string name = 1;
  optional string icon = 2;
  optional uint32 level = 3;
  optional uint32 exp = 4;
  optional string notice = 5;                       // 公告
  optional string chairman = 6;                     // 会长
  optional uint32 member_count = 7;                 // 当前成员数
  optional uint32 value = 8;                        // 俱乐部价值
}

// 公会列表数据
message GuildListEntry {
  optional uint64 guild_uid = 1;
  optional GuildBasicInfo guild_basic_info = 2;     // 展示信息
  optional uint64 timestamp = 3;
}

// 玩家列表数据
message PlayerListEntry {
  optional uint64 player_uid = 1;
  optional BasicInfo player_basic_info = 2;
  optional uint32 battle_force = 3;
  optional uint32 best_team_dan = 4;
  optional uint64 timestamp = 5;                    // 申请时间，超过3天的申请将被清除
}

// 红包数据
message GuildGiftReceiver {
  optional uint64 player_uid = 1;
  optional string name = 2;
  optional uint32 item_id = 3;
  optional uint32 count = 4;
}
message GuildGiftInfo {
  optional uint64 uid = 1;
  optional int32 gift_id = 2;                       // M_Red_Package.xlsx里的红包ID（Red_Package）字段
  optional uint64 timestamp = 3;                    // 发放时间
  optional string name = 4;                         // 发放者战队名
  repeated GuildGiftReceiver receivers = 5;         // 获得红包的人，看到谁领了多少是红包功能的核心所在。
  optional uint64 player_uid = 6;                   // 发放者的UID
}

// 心愿数据
message GuildWishInfo {
  optional uint64 player_uid = 1;                   // 发布心愿的人的player_uid
  optional uint32 item_id = 2;                      // 请求啥物品
  optional uint32 count = 3;                        // 已获得个数
  optional uint32 limit = 4;                        // 可获得最大个数
  repeated uint64 donators = 5;                     // 向这个心愿捐赠过的人的player_uid
}

// 公会数据
message GuildInfo {
  optional uint64 guild_uid = 1;                    // 公会UID
  optional GuildBasicInfo guild_basic_info = 2;     // 展示信息
  repeated GuildMember members = 3;                 // 成员列表
  // 以下字段只有会长接收时存在 ======================================
  repeated PlayerListEntry applying_players = 4;    // 审核列表
  optional uint64 change_icon_time = 20;            // 上次修改图标的时间
  // 以下字段通过其他协议发送   ======================================
  repeated GuildWishInfo wishes = 6;                // 心愿
  repeated GuildGiftInfo gifts = 7;                 // 红包
  repeated IntPair gift_sendings = 8;               // 发红包的次数
  optional uint64 gift_timestamp = 9;               // 发红包的时间戳
  optional uint32 rest_vigor = 21;                  // 多余体力
}

// 玩家数据
message PlayerGuildInfo {
  optional uint64 guild_uid = 1;                    // 所在公会UID
  optional uint64 last_leave_time = 2;              // 上次离开公会的时间
  repeated uint64 applied_guilds = 3;               // 申请过的公会UID
  repeated GuildListEntry inviting_guilds = 4;      // 发来邀请的公会
  optional uint64 signin_timestamp = 7;             // 上次签到时间
  optional uint64 wish_timestamp = 8;               // 上次发布心愿时间
  optional uint32 apply_count = 9;                  // 今日申请次数
  optional uint64 apply_timestamp = 10;             // 申请时间戳
  repeated uint64 rejected_guilds = 11;             // 今日拒绝玩家的公会
}

// =================================================================================================

// 公会信息
message C2S_GuildInfoRequest {
}
message S2C_GuildInfoResponse {
  optional ErrorCode error_code = 1;
  optional PlayerGuildInfo player_guild_info = 2;   // 在哪个公会，guild_uid=0表示不在公会里
  optional GuildInfo guild_info = 3;                // 如果在某个公会，这个字段是所在公会的信息
}

// 创建公会
message C2S_GuildCreateRequest {
  optional string guild_name = 2;
  optional string icon = 3;
}
message S2C_GuildCreateResponse {
  optional ErrorCode error_code = 1;
  optional GuildInfo guild_info = 2;
  optional PlayerGuildInfo player_guild_info = 3;   // 在哪个公会，guild_uid=0表示不在公会里
  optional C2S_GuildCreateRequest request = 4;
}

// 修改公会信息
message C2S_GuildEditRequest {
  optional string name = 1;
  optional string icon = 2;
  optional string notice = 3;
}
message S2C_GuildEditResponse {
  optional ErrorCode error_code = 1;
  optional GuildBasicInfo guild_basic_info = 2;
  optional C2S_GuildEditRequest request = 3;
}

// 操作公会成员
// 不同的title_type表示不同的操作：
//         GUILD_TITLE_INVALID 表示开除会员
//         GUILD_TITLE_CHAIRMAN 表示移交会长
//         GUILD_TITLE_VICE_CHAIRMAN 表示设置副会长
//         GUILD_TITLE_ELITE_MEMBER 表示设置精英
//         GUILD_TITLE_MEMBER 表示设置普通会员
message C2S_GuildModifyRequest {
  optional uint64 target_uid = 1;
  optional EGuildTitleType title_type = 2;
}
message S2C_GuildModifyResponse {
  optional ErrorCode error_code = 1;
  optional GuildInfo guild_info = 2;
  optional C2S_GuildModifyRequest request = 3;
}

// 加入 =================================================================================================

// 获取公会列表
message C2S_GuildListRequest {
  optional uint32 start_index = 1;                  // 从第几个公会开始的20个公会
}
message S2C_GuildListResponse {
  optional ErrorCode error_code = 1;
  optional uint32 start_index = 2;
  repeated GuildListEntry entries = 3;
}

// 搜索公会
message C2S_GuildSearchRequest {
  optional string guild_name = 1;
}
message S2C_GuildSearchResponse {
  optional ErrorCode error_code = 1;
  optional uint64 guild_uid = 2;                    // 公会UID
  optional GuildBasicInfo guild_basic_info = 3;     // 展示信息
  optional C2S_GuildSearchRequest request = 4;
}

// 招新列表
message C2S_GuildRecruitListRequest {
}
message S2C_GuildRecruitListResponse {
  optional ErrorCode error_code = 1;
  repeated PlayerListEntry player_entries = 2;      // 玩家列表
}

// 邀请玩家入会
message C2S_GuildRecruitRequest {
  optional uint64 player_uid = 1;
}
message S2C_GuildRecruitResponse {
  optional ErrorCode error_code = 1;
  optional C2S_GuildRecruitRequest request = 2;
}

// 申请进入公会
// 发起申请返回成功后把guild_info.guild_uid加到自己的PlayerGuildInfo.applied_guilds里。
message C2S_GuildApplyRequest {
  optional uint64 guild_uid = 1;
  optional bool is_cancel = 2;                      // 如果这个字段填true，表示取消申请
}
message S2C_GuildApplyResponse {
  optional ErrorCode error_code = 1;                // 如果是EC_Success表示直接进入公会；如果是EC_GuildApplyWouldWait表示需要等待会长通过申请
  optional uint64 guild_uid = 2;
  optional C2S_GuildApplyRequest request = 3;
}

// 操作入会申请
message C2S_GuildApplyEditRequest {
  optional bool remove_all = 1;                     // 如果是true，表示删除所有申请；之后的字段不起作用
  optional bool is_reject = 2;                      // 如果是true，表示要拒绝UID=player_uid的玩家的申请，否则表示要通过这个玩家的申请
  optional uint64 player_uid = 3;                   // 目标玩家
}
message S2C_GuildApplyEditResponse {
  optional ErrorCode error_code = 1;
  optional C2S_GuildApplyEditRequest request = 2;
  repeated PlayerListEntry applying_players = 4;    // 审核列表
}

// 退出公会
message C2S_GuildQuitRequest {
}
message S2C_GuildQuitResponse {
  optional ErrorCode error_code = 1;
  optional PlayerGuildInfo player_guild_info = 2;
}

// 红包 =================================================================================================

// 获取红包信息
message C2S_GuildGiftInfoRequest {
}
message S2C_GuildGiftInfoResponse {
  optional ErrorCode error_code = 1;
  repeated GuildGiftInfo gifts = 2;                 // 红包
  repeated IntPair gift_sendings = 3;               // 发红包的次数
  optional uint64 gift_timestamp = 4;               // 发红包的时间戳
}

// 发红包
message C2S_GuildSendGiftRequest {
  optional uint32 gift_id = 1;                      // 啥类型的礼包
}
message S2C_GuildSendGiftResponse {
  optional ErrorCode error_code = 1;
  optional GuildGiftInfo gift_info = 2;
  repeated Item items = 3;
}

// 收红包
message C2S_GuildReceiveGiftRequest {
  optional uint64 gift_uid = 1;
}
message S2C_GuildReceiveGiftResponse {
  optional ErrorCode error_code = 1;
  optional Item item = 2;
}

// 心愿/碎片 =================================================================================================

// 获取心愿信息
message C2S_GuildWishInfoRequest {
}
message S2C_GuildWishInfoResponse {
  optional ErrorCode error_code = 1;
  repeated GuildWishInfo wishes = 2;
}

// 发布心愿
message C2S_GuildWishRequest {
  optional uint32 item_id = 1;
}
message S2C_GuildWishResponse {
  optional ErrorCode error_code = 1;
  optional GuildWishInfo wish = 2;
}

// 捐赠心愿
message C2S_GuildDonateRequest {
  optional uint64 player_uid = 1;                   // 发布心愿者
}
message S2C_GuildDonateResponse {
  optional ErrorCode error_code = 1;
  optional GuildWishInfo wish = 2;
}

// 其他 =================================================================================================

// 签到
message C2S_GuildSignInRequest {
}
message S2C_GuildSignInResponse {
  optional ErrorCode error_code = 1;
  repeated Item items = 3;
  optional GuildBasicInfo guild_basic_info = 4;
  optional GuildMember guild_member = 5;
}

// 切磋
message C2S_GuildCompareRequest {
  optional uint64 target_uid = 1;                 // 和谁切磋
}
message S2C_GuildCompareResponse {
  optional ErrorCode error_code = 1;
}

